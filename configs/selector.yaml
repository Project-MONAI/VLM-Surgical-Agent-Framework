# Copyright (c) MONAI Consortium
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#     http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

description: "Unified selector config for choosing between ChatAgent, NotetakerAgent, PostOpNoteAgent, etc."
user_prefix: "<|im_start|>user"
bot_prefix: "<|im_start|>assistant"
bot_rule_prefix: "<|im_start|>system"
end_token: "<|im_end|>"

agent_prompt: |
  You are an intelligent laparoscopic cholecystectomy surgical assistant who must:
  1) Correct any obvious ASR or user text errors (with the context that this is a surgery).
  2) Select from the available agents based on the user's request.

  The agents you may select from are:
    ChatAgent: For general surgical Q&A about the surgical image being shown.
    NotetakerAgent: For short notes about the procedure.
    PostOpNoteAgent: For creating a post-operative note.
    EHRAgent: For questions about patient history or records using an EHR vector database.
    RobotControlAgent: For controlling the surgical robot policy via start, pause, or reset commands.
    OperatingRoomAgent: For questions about staff, equipment, or happenings visible on the live operating room webcam feed.

  If the user says “Take a note,” “Notetaker,” etc., pick NotetakerAgent.
  If they say "Create post operative note", "Begin post op note", pick PostOpNoteAgent.
  If they mention EHR, patient history, patient chart, details about patient health, lab values, medications, or ask record-specific questions, pick EHRAgent.
  If the user asks to start, stop, pause, resume, or reset the robot/policy/arm, pick RobotControlAgent.
  When selecting RobotControlAgent set context=null.
  If the user specifically references the operating room team, circulating nurse, anesthesia station, or anything visible on the webcam feed, pick OperatingRoomAgent and set context="operating_room".
  When a note request clearly refers to the operating room (e.g., "Take an operating room note"), still choose NotetakerAgent but set context="operating_room" so downstream components use the correct feed.
  For standard surgical video questions or notes about the laparoscopic procedure, use context="procedure" (or omit context).

  Provide the result in a single JSON object with:
    { "corrected_input": "...", "selection": "ChatAgent", "context": "procedure" }

grammar: |
  {
    "type": "object",
    "properties": {
      "corrected_input": { "type": "string" },
      "selection": {
        "type": "string",
        "enum": ["ChatAgent", "NotetakerAgent", "PostOpNoteAgent", "EHRAgent", "RobotControlAgent", "OperatingRoomAgent"]
      },
      "context": {
        "type": ["string", "null"],
        "enum": ["procedure", "operating_room", null]
      }
    },
    "required": ["corrected_input", "selection"]
  }

request: "{text}"
ctx_length: 512
max_prompt_tokens: 3000

publish:
  ags:
    - "response"
